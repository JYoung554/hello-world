#include <iostream>
#include <fstream>
#include <cstdlib>
#include <string>

using namespace std;


class account_query
{
  private:
    char account_number[20] ;
    char firstName[20];
    char lastName[20];
    float total_Balance;

    public:
        void read_data();
        void show_data();
        void write_rec();
        void read_rec();
        void show_rec();
        void search_rec();
        void edit_rec();
        void delete_rec();

};

void account_query::read_data()
{       cout<<"\nEnter Account Number: ";
        cin>>account_number;
        cout<<"Enter First Name : ";
        cin>>firstName;
        cout<<"Enter Last Name : ";
        cin>>lastName;
        cout<<"Enter Balance : ";
        cin>>total_Balance;
        cout<<endl;
}

void account_query::show_data()
{
        cout<<"Account Number : "<<account_number<<endl;
        cout<<"First Name : "<<firstName<<endl;
        cout<<"Last Name : "<<lastName<<endl;
        cout<<"Current Balance:   "<<total_Balance<<endl;
        cout<<"-------------------------------"<<endl;
        }

void account_query::write_rec()
{       ofstream outfile;
        outfile.open("record.bank", ios::binary);
        read_data();
        outfile.write(reinterpret_cast<char *>(this), sizeof(*this));
        outfile.seekp(0, ios::end);
        outfile.close();

}

void account_query::read_rec(){
        ifstream infile;
        infile.open("record.bank", ios::binary);
        if (!infile)
        {
            cout<<"Error ! File not found!"<<endl;

        }


        cout<<"\n ****Data from file****"<<endl;

        while (!infile.eof())
            {
            if (infile.read(reinterpret_cast<char*>(this), sizeof(*this))>0)
            {
               show_data();

                }

            }
        infile.close();
}

void account_query::search_rec(){
            int n;
            ifstream infile;
            infile.open("record.bank", ios::binary);
            if (!infile){

            cout<<"\nError ! File Not Found!!"<<endl;
            return;
            }

            infile.seekg(0, ios::end);


            int count =infile.tellg()/sizeof(*this);
            cout<<"\n There are "<<count<<" records in this file";
            cout<<"\n Please enter a number : "<<endl;
            cin>>n;
            infile.seekg((n-1)*sizeof(*this));
            infile.read(reinterpret_cast<char*>(this), sizeof(*this));
            show_data();

}

void account_query::edit_rec(){
            int n;
            fstream iofile;
            iofile.open ("record.bank" ,ios::in |ios::binary);
            if (!iofile){
                cout<<"\nError ! File Not Found!!"<<endl;
                return;

                };


                iofile.seekg(0, ios::end);
                int count = iofile.tellg()/sizeof(*this);
                cout<<"\n There are "<<count<<" records in this file";
                cout<<"\n Enter Record Number to edit"<<endl;
                cin>>n;
                iofile.seekg((n-1)*sizeof(*this));
                iofile.read(reinterpret_cast<char*>(this), sizeof(*this));
                cout<<"Record"<<n<<"has following data"<<endl;
                show_data();
                iofile.close();
                }


void account_query::delete_rec(){
                int n;
                ifstream infile;
                infile.open("record.bank", ios::binary);
                if (!infile){
                    cout<<"\nError ! File Not Found!!"<<endl;
                    return;
                    };
                infile.seekg(0, ios::end);
                int count= infile.tellg()/sizeof(*this);
                cout<<"\n There are "<<count<<" records in the file"<<endl;
                cout<<"\n Enter Record Number to delete"<<endl;
                cin>>n;
                fstream tmpfile;
                tmpfile.open("tmpfile.bank", ios::out | ios::binary);
                infile.seekg(0);
                for (int i=0; i<count; i++)
                {
                    infile.read(reinterpret_cast<char*>(this),sizeof(*this));
                    if (i==(n-1))
                            continue;
                        tmpfile.write(reinterpret_cast<char*>(this), sizeof(*this));
                        }
                    infile.close();
                    tmpfile.close();
                    remove ("record.bank");
                    rename ("tmpfile.bank", "record.bank");
                }














int main(){



    string mystr;
cout<<"What Is Your Name? \n";
getline(cin, mystr);
cout<<"Hello "<<mystr<<",\n";
cout<<"What Is Your Favorite Bank? \n";
getline(cin, mystr);
cout<<"Me too!"<<endl;

account_query A;

int choice;
cout<<"***Account Information***"<<endl;
        while (true){
          cout<<"Select one option below ";
          cout<<"\n\t1-->Add record to file";
            cout<<"\n\t2-->Show record from file";
            cout<<"\n\t3-->Search record from file";
            cout<<"\n\t4-->Update record";
            cout<<"\n\t5-->Delete record";
            cout<<"\n\t6-->Quit";
            cout<<"\n\Enter your choice : ";
            cin>>choice;

            switch(choice){
            case 1:
                A.write_rec();
            break;
            case 2:
                A.read_rec();
            break;
            case 3:
                A.search_rec();
            break;
            case 4:
                A.edit_rec();
            break;
            case 5:
                A.delete_rec();
            break;
            case 6:
                exit(0);
            break;

            default:
                cout<<"\nEnter correct choice";
                exit(0);
            }
        }
            system("Pause");
            return 0;
            }

